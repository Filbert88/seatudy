generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(uuid())
  email         String          @unique
  password      String
  phoneNumber   String
  campus        String
  role          Role            @default(USER)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  courses       CourseEnrollment[]
  reviews       Review[]
  assignments   Submission[]
  balance       Float           @default(0.0)
  forumPosts    ForumPost[]
  forumComments ForumComment[]
  notifications Notification[]
  transactions  Transaction[]
  instructedCourses Course[]
}

model Course {
  id            String             @id @default(uuid())
  title         String
  description   String
  syllabus      String
  instructor    User               @relation(fields: [instructorId], references: [id])
  instructorId  String
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  enrollments   CourseEnrollment[]
  reviews       Review[]
  assignments   Assignment[]
  materials     CourseMaterial[]
  forumPosts    ForumPost[]
  categories    CourseCategoryCourse[]
  difficulty    DifficultyLevel
  averageRating Float?             @default(0.0)
  forums        Forum[]
  transactions  Transaction[]
}

model CourseEnrollment {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  course     Course   @relation(fields: [courseId], references: [id])
  courseId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  progress   CourseProgress[]
  @@unique([userId, courseId]) 
}

model CourseProgress {
  id           String           @id @default(uuid())
  enrollment   CourseEnrollment @relation(fields: [enrollmentId], references: [id])
  enrollmentId String
  progress     Float            @default(0.0)  
  lastAccess   DateTime         @default(now())
}

model CourseCategory {
  id    String   @id @default(uuid())
  name  String   @unique
  categories CourseCategoryCourse[]
}

model CourseCategoryCourse {
  courseId       String
  categoryId     String
  course         Course   @relation(fields: [courseId], references: [id])
  category       CourseCategory @relation(fields: [categoryId], references: [id])
  @@id([courseId, categoryId])
}

model CourseMaterial {
  id          String   @id @default(uuid())
  title       String
  url         String
  course      Course   @relation(fields: [courseId], references: [id])
  courseId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  @@unique([title, courseId])
}

model Assignment {
  id          String     @id @default(uuid())
  title       String
  description String
  dueDate     DateTime
  course      Course     @relation(fields: [courseId], references: [id])
  courseId    String
  submissions Submission[]
  @@unique([title, courseId])
}

model Submission {
  id           String     @id @default(uuid())
  content      String
  createdAt    DateTime   @default(now())
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  assignmentId String
  student      User       @relation(fields: [studentId], references: [id])
  studentId    String
  grade        Float?
  @@unique([assignmentId, studentId]) 
}

model Review {
  id        String   @id @default(uuid())
  content   String
  rating    Int
  course    Course   @relation(fields: [courseId], references: [id])
  courseId  String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Forum {
  id         String       @id @default(uuid())
  course     Course       @relation(fields: [courseId], references: [id])
  courseId   String
  posts      ForumPost[]
}

model ForumPost {
  id         String       @id @default(uuid())
  content    String
  forum      Forum        @relation(fields: [forumId], references: [id])
  forumId    String
  user       User         @relation(fields: [userId], references: [id])
  userId     String
  comments   ForumComment[]
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  @@unique([content, forumId, userId])  
  course     Course       @relation(fields: [courseId], references: [id])
  courseId   String
}

model ForumComment {
  id         String       @id @default(uuid())
  content    String
  post       ForumPost    @relation(fields: [postId], references: [id])
  postId     String
  user       User         @relation(fields: [userId], references: [id])
  userId     String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  @@unique([content, postId, userId])  
}

model Notification {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  message   String
  type      NotificationType
  createdAt DateTime @default(now())
  read      Boolean  @default(false)
}

model Transaction {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  course    Course?  @relation(fields: [courseId], references: [id])
  courseId  String?  
  amount    Float
  createdAt DateTime @default(now())
  type      TransactionType
}

enum TransactionType {
  DEPOSIT
  PURCHASE
}

enum Role {
  USER
  INSTRUCTOR
  ADMIN
}

enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum NotificationType {
  ASSIGNMENT_SUBMISSION
  COURSE_PURCHASE
}
